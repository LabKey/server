// This module set builds all modules in the following directories:
//
//    /server/modules
//    /server/modules
//    /server/testAutomation/modules
//
// Goal is to build all the LabKey modules, skipping most of the modules in externalModules. This module set can be useful when
// refactoring core code, performing the end-of-release-cycle script consolidation process, updating licenses, etc.
//
// Some external modules are built: the snprc EHR modules plus EHR build-time and runtime dependencies.

buildscript {
    repositories {
        maven {
            url "${artifactory_contextUrl}/plugins-release"
        }
        if (gradlePluginsVersion.contains("SNAPSHOT"))
        {
            maven {
                url "${artifactory_contextUrl}/plugins-snapshot-local"
            }

        }
    }
    dependencies {
        classpath "org.labkey.build:gradlePlugins:${gradlePluginsVersion}"
    }
    configurations.all {
        // Check for updates every build for SNAPSHOT dependencies
        resolutionStrategy.cacheChangingModulesFor 0, 'seconds'
    }
}
import org.labkey.gradle.util.BuildUtils

List<String> excludedModules = [
    'labkey-api-js', 'labkey-api-r', 'labkey-api-python'     // Might be enlisted in server/modules
]

include ":server:modules:LabDevKitModules:LDK"                // EHR modules depend on LDK
include ":server:modules:LabDevKitModules:laboratory"         // Without this, EHR builds fail with "Could not find LDK-api.jar" error
include ":server:modules:onprcEHRModules:mergesync"     // onprc_ehr runtime dependency

include ":server:modules:snprcEHRModules:snprc_ehr"
include ":server:modules:snprcEHRModules:snprc_genetics"
include ":server:modules:snprcEHRModules:snprc_r24"
include ":server:modules:snprcEHRModules:snprc_scheduler"

// This line includes all modules in the server/modules, server/customModules and server/modules directories
BuildUtils.includeModules(this.settings, rootDir, BuildUtils.SERVER_MODULE_DIRS, excludedModules);
